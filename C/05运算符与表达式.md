# 运算符与表达式

* 运算符
* 表达式
* 运算符优先级

## 运算符

* 根据操作数的数量可以分为：一元运算符、二元运算符和三元运算符
* 根据用途可以分为以下几类：
  * 赋值运算符
  * 算术运算符
  * 关系运算符
  * 逻辑运算符
  * 位运算符

### 算术运算符

| 一元运算符 |  操作  | 二元运算符 | 操作  |
| :--------: | :----: | :--------: | :---: |
|     -      | 一元减 |     +      |  加   |
|     ++     |  递增  |     -      |  减   |
|     --     |  递减  |     *      |  乘   |
|            |        |     /      |  除   |
|            |        |     %      |  模   |
|            |        | pow(函数)  |  幂   |

**注意：**
前置 ++ 和后置 ++ 区别很大，例如下面的运算

```c
int i = 0;
int n = 0;
n = ++i; // 1)

i = 0;
n = i++; // 2)
```

在1)中的前置++可以以下代码:

```c
i = i + 1;
```

在2)中的后置++可以以下代码:

```c
int temp = i;
i = i + 1;
n = temp;
```

所以在1）中赋值之后 `n` 的值为1，`i` 的值为1；在2）中赋值之后 `n` 的值为0，`i` 的值为1。

> **前置--和后置--的差异与++相同**

#### 算术运算符的优先级

| 运算符类型 |  运算符   | 结合方向 |
| :--------: | :-------: | :------: |
|    一元    | -、++、-- | 从右向左 |
|    二元    |  *、/、%  | 从左向右 |
|    三元    |   +、-    | 从左向右 |

*结合性是指，当一个操作数两侧的运算符具有相同的优先级时，该操作数是先与左边的运算符结合还是先与右边的运算符结合。*

### 赋值运算符

赋值运算符也就是 `=`，它的作用是将一个表达式的值赋值给一个变量。

通用的形式为：`变量名=表达式`

将同一个值赋给多个变量的操作叫做多重赋值。如 `a=b=c=10`

#### 复合赋值运算符

| 运算符 | 表达式  | 结果(假设x=10, y = 3) |
| :----: | :-----: | :-------------------: |
|   +=   | x += 5  |          15           |
|   -=   | x -= 5  |           5           |
|   *=   | x *= 5  |          50           |
|   /=   | x /= 5  |           2           |
|   %=   | x %= 5  |           0           |
|   ^=   | y ^= 1  |           2           |
|  <<=   | y <<= 1 |           6           |
|  >>=   | y >>= 1 |           1           |
|   &=   | y &= 2  |           1           |
|  \|=   | y \|= 0 |           3           |

#### 赋值运算符优先级

* 所有的赋值运算符优先级相同
* 始终按从右向左顺序进行计算
* **赋值运算符的优先级低于算术运算符**

### 关系运算符

| 运算符 | 关系运算 |
| :----: | :------: |
|   >    |   大于   |
|   >=   | 大于等于 |
|   <    |   小于   |
|   <=   | 小于等于 |
|   ==   |   等于   |
|   !=   |  不等于  |

关系运算符用于测试两个操作数，或则两个表达式之间的关系。其中的操作数可以是变量、常量和表达式。测试的结果为`真(1)`或`假(0)`。

#### 关系运算符的优先级

`<` = `<=` = `>` = `>=` > `==` > `!=`

### 逻辑运算符

| 运算符 | 逻辑运算 | 说明                                                                         |
| :----: | :------: | ---------------------------------------------------------------------------- |
|   &&   |    与    | 当且仅当两个运算量的值都为真时，运算的结果才为真，否则为假                   |
|  \|\|  |    或    | 当且仅当两个运算量的值都为假时，运算的结果才为假，否则为真                   |
|   !    |    非    | 当运算量的值都为真时，其运算结果为假。当运算量的结果为假时，其运算结果为真。 |

| 优先级  | 运算符 | 结合方向 |
| :-----: | :----: | :------: |
| 1(最高) |   !    | 从右向左 |
|    2    |   &&   | 从左向右 |
|    3    |  \|\|  | 从左向右 |

### 位运算符

将数字转换成二进制形式后再按位计算
|     运算符      | 描述                                                                         |
| :-------------: | ---------------------------------------------------------------------------- |
|  按位与(x & y)  | 如果两个操作数的相应位均为1，则该位的结果值为1                               |
|   按位或(\|)    | 如果两个操作数的相应位有一个为1，则该位的结果值为1                           |
|   按位取反(~)   | 将操作数按位取反                                                             |
| 按位异或(x ^ y) | 如果两个操作数的相应位相同则相应为结果为0，否则相应位结果为1                 |
|  左移 (x << 2)  | 左端(高位)移除部分舍弃, 右端(低位)补0                                        |
|  右移 (x >> 2)  | 右端(低位)移除部分舍弃, 左端(高位)根据符号位补0或1，无符号或正数补0，负数补1 |

*右移：*
*逻辑右移： 高位补 0 (对于无符号数来说，>> 是指逻辑右移)*
*算术右移: 保留符号位不变（对于正数，高位为0，对于负数高位为1）*

> C 语言没有规定有符号数的 `>>` 是逻辑右移还是算术右移
> 但是几乎所有的编译器对于有符号数的 `>>` 都实现为算术右移

#### 位运算符的优先级

| 运算符类型 | 运算符 | 结合方向(优先级从上往下递减) |
| :--------: | :----: | :--------------------------: |
|    一元    |   ~    |           从右向左           |
|    二元    | <<、>> |           从左向右           |
|    二元    |   &    |           从左向右           |
|    二元    |   ^    |           从左向右           |
|    二元    |   \|   |           从左向右           |

### 运算符优先级总结

! > 算术运算符 > 关系运算符 > && > || > 赋值运算符

## 表达式

* 赋值表达式
* 算术表达式
* 关系表达式
* 逻辑表达式
* 函数表达式

### 算术表达式

算术表达式中的运算符都是算术运算符。下面是一些算术表达式示例：

* (x + y) / 2
* ++i % 7
* 5 + (a = 3 + 4)

**注意：在使用`printf`输出时应该使用正确的格式化参数对应算术表达式的结果。下面的示例中2）会产生错误的结果**

```c
printf("%f\n", 22.0 / 5);   // 1）
printf("%f\n", 22 / 5);     // 2) 错误的结果
```

## 类型转换

### 隐式类型转换

运算符的操作数属于不同的数据类型时，运算符通常会将这些操作数转换为同一类型，由编译系统自动完成(所以一般称为**隐式转换**)。

在赋值表达式中，自动将赋值运算符右边表达式的值的类型转换成左边变量的类型。

**下面是转换的趋势，低级别想高级别转换。**

`char` > `short` > `int` > `long` > `float` > `double` > `long double`

### 强制类型转换

通常可以通过使用强制转换将一个表达式的类型转换成另一种类型。转换的通用语法是 `(type)cast`。例如：

```c
printf("%f", (float)10);
printf("%d", (int)(3 * 1.25));
printf("%d", 3 * (int)1.25);
```
